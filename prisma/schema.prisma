generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model UserSettings {
  id              String   @id @default(uuid())
  userId          String   @unique
  currency        String   @default("USD")
  timezone        String   @default("America/New_York")
  
  // Business Profile
  businessName    String?
  businessType    String?  // LLC, Corporation, Sole Proprietorship, etc.
  industry        String?
  location        String?  // City, Country
  foundedYear     Int?
  employeeCount   Int?
  website         String?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model FinancialData {
  id              String   @id @default(uuid())
  userId          String   @unique
  cashBalance     Float    @default(847290)
  monthlyBurn     Float    @default(42350)
  runway          Int      @default(20)
  monthlyRevenue  Float    @default(67800)
  updatedAt       DateTime @updatedAt
}

model Transaction {
  id                  String   @id @default(uuid())
  userId              String
  
  // Transaction Details
  name                String   // Description of transaction
  description         String?  // Additional details
  category            String
  amount              Float
  type                String   @default("expense") // income or expense
  
  // Vendor/Customer Info
  vendor              String?  // Who you paid or received from
  vendorType          String?  // supplier, customer, service_provider, etc.
  
  // Payment Details
  paymentMethod       String?  // credit_card, bank_transfer, cash, etc.
  referenceNumber     String?  // Invoice #, Receipt #, etc.
  
  // For multi-currency
  originalAmount      Float?
  originalCurrency    String?
  exchangeRate        Float?
  
  // Metadata
  date                DateTime @default(now())
  status              String   @default("completed") // pending, completed, cancelled
  tags                String[] // For flexible categorization
  attachments         String[] // URLs to receipts/invoices
  
  @@index([userId])
  @@index([date])
  @@index([category])
  @@index([vendor])
}

model ExchangeRate {
  id            String   @id @default(uuid())
  fromCurrency  String
  toCurrency    String
  rate          Float
  fetchedAt     DateTime @default(now())
  
  @@unique([fromCurrency, toCurrency])
}

model Anomaly {
  id              String   @id @default(uuid())
  userId          String
  
  title           String
  description     String
  severity        String   // high, medium, low
  status          String   @default("open") // open, investigating, resolved, dismissed
  category        String   // spending_spike, duplicate, unusual_pattern, etc.
  
  // Financial impact
  amount          Float?
  currency        String?
  potentialSavings Float?
  
  // Related data
  relatedTransactionIds String[]
  
  // AI Analysis
  aiConfidence    Float?   // 0-1 confidence score
  aiRecommendation String?
  
  // Timestamps
  detectedAt      DateTime @default(now())
  resolvedAt      DateTime?
  
  @@index([userId])
  @@index([status])
  @@index([detectedAt])
}
